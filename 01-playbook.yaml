- name: Carbon Black Cloud
  hosts: localhost.localdomain
  become: yes
  tasks:
  - name: ping the server
    ansible.builtin.ping:

  - name: Copy file with owner and permissions
    ansible.builtin.copy:
      src: /root/cb-psc-sensor-rhel-2.13.2.1054252.tar
      dest: /root/cb-psc-sensor-rhel-2.13.2.1054252.tar

  - name: extract carbon black cloud tar file
    ansible.builtin.unarchive:
      src: /root/cb-psc-sensor-rhel-2.13.2.1054252.tar
      dest: /root
      remote_src: yes

  - name: Create a directory if it does not exist
    ansible.builtin.file:
      path: /root/cb-psc-install
      state: directory
      mode: '0755'

  - name: Run a script with arguments (using 'cmd' parameter)
    ansible.builtin.script:
      cmd: sudo sh /root/install.sh 25LDH52OWR4SWB7YRJH

  - name: start and enable cbagentd
    ansible.builtin.service:
      name: cbagentd
      state: restarted
      enabled: yes